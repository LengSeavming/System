<!-- Loading State -->
<div *ngIf="isLoading" class="w-full px-6 pt-5">
    <div>Loading...</div>
</div>

<!-- Main Section -->
<div *ngIf="!isLoading" class="out-create-section md-form-field-appearance-outline">

    <!-- Dialog Title -->
    <div mat-dialog-title class="min-h-14 max-h-14 flex gap-2 justify-between items-center py-2 pl-5 pr-2.5 border-b">
        <div class="flex flex-1 items-center text-slate-500">
            <h1 class="text-3xl">{{element.name}}</h1>
        </div>

        <!-- Close Button -->
        <div class="flex items-center cursor-pointer pl-2">
            <button mat-icon-button (click)="closeDialog()">
                <mat-icon class="-mb-0.5" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
            </button>
        </div>
    </div>
    <hr class="fixed top-20 right-0 w-[750px] z-999">
    <!-- Main Content -->
    <div class="out-create-body  pb-5" *ngIf="!isLoading && element">
        <mat-tab-group class="custom-tab-group mat-tab-flex-grow mt-2">
            <!-- Tab headers -->
            <mat-tab label="ទូទៅ">
                <div class="flex flex-col items-center gap-2 mt-10">
                    <div class="w-full flex justify-center overflow-hidden">
                        <img class="border-2 w-32 h-32 border-blue-500 object-cover rounded-full"
                            [src]="fileUrl + element?.image" alt="Profile Image">
                    </div>

                    <div class="flex flex-row justify-center max-w-50">
                        <span class="text-gray-800 text-3xl dark:text-gray-300">{{element?.name}}</span>
                    </div>

                    <div class="flex flex-row justify-center">
                        <span class="text-gray-500">{{element?.code}} | {{element.type?.name}} | {{element?.unit_price}}
                            ៛
                        </span>
                    </div>
                </div>
                <div class="mt-3 px-4">
                    <div class="flex justify-start items-center gap-2 p-1 w-full bg-gray-50 dark:bg-gray-800 h-[3rem]">
                        <div class="flex justify-start items-center gap-2 w-[150px]">
                            <mat-icon svgIcon="mdi:receipt-text-outline"></mat-icon>
                            <p class="text-lg md:text-xl leading-8">ចំនួនលក់</p>
                        </div>
                        <div class="flex justify-start items-center gap-2">
                            <p class="text-lg md:text-xl leading-8">៖</p>
                            <p class="text-lg md:text-xl leading-8 pl-5">{{element.total_sale || 0 | number}}</p>
                        </div>
                    </div>
                    <!-- doc number -->
                    <div class="flex justify-start items-center gap-2 p-1 w-full dark:bg-gray-800 h-[3rem]">
                        <div class="flex justify-start items-center gap-2 w-[150px]">
                            <mat-icon svgIcon="mdi:cash"></mat-icon>
                            <p class="text-lg md:text-xl leading-8">តម្លៃលក់(រៀល)</p>
                        </div>
                        <div class="flex justify-start items-center gap-2">
                            <p class="text-lg md:text-xl leading-8">៖</p>
                            <p class="text-lg md:text-xl leading-8 pl-5">{{element.total_sale * element.unit_price |
                                number}}</p>
                        </div>
                    </div>
                    <div class="flex justify-start items-center gap-2 p-1 w-full bg-gray-50 dark:bg-gray-800 h-[3rem]">
                        <div class="flex justify-start items-center gap-2 w-[150px]">
                            <mat-icon svgIcon="mdi:calendar-range"></mat-icon>
                            <p class="text-lg md:text-xl leading-8">កាលបរិច្ឆេទ</p>
                        </div>
                        <div class="flex justify-start items-center gap-2">
                            <p class="text-lg md:text-xl leading-8">៖</p>
                            <div class="flex pl-5">
                                <img class="border border-blue-200 min-w-8 max-w-8 min-h-8 max-h-8 object-cover rounded-full"
                                    [src]="fileUrl + element.creator?.avatar" alt="profile">
                                <p class="text-lg md:text-xl leading-8 pl-2"> {{element?.created_at | date:
                                    'dd-LL-YYY'}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab label="ការលក់">
                <div class="list-sale-body">
                    <!-- Show 'No Data' message if the data source is empty -->
                    <div *ngIf="dataSource.data.length === 0 && !isLoading"
                        class="no-data bg-white border-t dark:hover:bg-gray-800">
                        <div class="flex flex-col justify-center items-center mb-4">
                            <mat-icon class="icon-size-24" svgIcon="toc"></mat-icon>
                            <span class="text-2xl -mt-3">គ្មានទិន្នន័យ</span>
                        </div>
                    </div>

                    <!-- Show data table if there is data -->
                    <div *ngIf="dataSource.data.length > 0"
                        class="list-sale-content px-4 pb-4 bg-white rounded-bl-xl rounded-br-xl dark:bg-gray-800">
                        <div class="list-sale-data border-t">
                            <table mat-table [dataSource]="dataSource">

                                <ng-container matColumnDef="no">
                                    <th mat-header-cell *matHeaderCellDef class="w-10">ល.រ</th>
                                    <td mat-cell *matCellDef="let i = index">
                                        <span>{{i+1}}.</span>
                                    </td>
                                </ng-container>

                                <!-- Receipt Column -->
                                <ng-container matColumnDef="receipt">
                                    <th mat-header-cell *matHeaderCellDef class="w-[20px]">វិក្ក័យប័ត្រ</th>
                                    <td mat-cell *matCellDef="let element">
                                        <span>{{ element.receipt_number }}</span>
                                    </td>
                                </ng-container>

                                <!-- Price Column -->
                                <ng-container matColumnDef="price">
                                    <th mat-header-cell *matHeaderCellDef class="min-w-36 text-right">តម្លៃលក់​(រៀល)
                                    </th>
                                    <td mat-cell *matCellDef="let element" class="text-right">
                                        <span class="text-gray-500">{{ element?.total_price | number }}</span>
                                    </td>
                                </ng-container>

                                <!-- Ordered At Column -->
                                <ng-container matColumnDef="ordered_at">
                                    <th mat-header-cell *matHeaderCellDef class="min-w-36 text-center">កាលបរិច្ឆេទ</th>
                                    <td mat-cell *matCellDef="let element" class="text-right">
                                        <span class="text-gray-500">{{ element?.ordered_at | date: 'dd-LL-YYY' }}</span>
                                    </td>
                                </ng-container>

                                <!-- Ordered At time Column -->
                                <ng-container matColumnDef="ordered_at_time">
                                    <th mat-header-cell *matHeaderCellDef class="min-w-30 text-center">ម៉ោង</th>
                                    <td mat-cell *matCellDef="let element" class="text-center">
                                        <span class="text-gray-500"> {{ element?.ordered_at | date: 'hh:mm a' }}</span>
                                    </td>
                                </ng-container>

                                <ng-container matColumnDef="seller">
                                    <th mat-header-cell *matHeaderCellDef class="min-w-[120px] text-right">អ្នកគិតប្រាក់
                                    </th>
                                    <td mat-cell *matCellDef="let element" class="text-right">
                                        <div class="flex items-center justify-end space-x-2">
                                            <!-- Profile Image with Icon-based Status Indicator -->
                                            <div class="relative min-w-8 max-w-8 min-h-8 max-h-8">
                                                <img class="w-full h-full object-cover rounded-full border border-blue-200"
                                                    [src]="fileUrl + element.cashier?.avatar" alt="profile">

                                                <!-- Status Indicator with Icon -->
                                                <span
                                                    class="absolute bottom-0 right-0 w-4 h-4 bg-white border-2 border-white dark:border-gray-800 rounded-full flex items-center justify-center">
                                                    <mat-icon *ngIf="element.platform === 'Web'" class="icon-size-4"
                                                        svgIcon="mdi:monitor">
                                                    </mat-icon>

                                                    <mat-icon *ngIf="element.platform === 'Mobile'" class="icon-size-4"
                                                        svgIcon="mdi:cellphone">
                                                    </mat-icon>

                                                    <mat-icon
                                                        *ngIf="element.platform === 'Unknown' || element.platform === null"
                                                        class="icon-size-4" svgIcon="mdi:crosshairs-question">
                                                    </mat-icon>
                                                </span>
                                            </div>
                                        </div>
                                    </td>

                                </ng-container>
                                <!-- Table Rows -->
                                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                            </table>
                        </div>
                    </div>
                </div>
            </mat-tab>
        </mat-tab-group>
    </div>
</div>
